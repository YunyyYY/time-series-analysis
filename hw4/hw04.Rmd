---
title: "Homework 4"
author: "Lingyun Guo"
date: "2/14/2020"
output: html_document
---

\newcommand\prob{\mathbb{P}}
\newcommand\E{\mathbb{E}}
\newcommand\ar{\phi}
\newcommand\ma{\psi}
\newcommand\var{\mathrm{Var}}
\newcommand\cov{\mathrm{Cov}}

---

### Question 4.1

The spectrum density for the ARMA$(p,q)$ process [1]: \(\ar(B)Y_n = \ma(B)\epsilon_n\) is defined as \[f_{ARMA}(\omega) = \sigma^2\left|\frac{\ma(e^{-2\pi i \omega})}{\ar(e^{-2\pi i \omega})}\right|^2.\]

**A.** For \(X_n=1.5X_{n−1}−0.8X_{n−2}+\epsilon_n\), \[
\begin{aligned}
\ar(B) &= 0.8B^2 - 1.5B + 1\\
\ma(B) &= 1
\end{aligned}
\]
therefore, its spectral density is \[
\begin{aligned}
\lambda(\omega) &= \sigma^2\frac{1}{|0.8(e^{-2\pi i \omega})^2 - 1.5e^{-2\pi i \omega} + 1|^2} \\
&= \frac{\sigma^2}{(0.8e^{-4\pi i \omega} - 1.5e^{-2\pi i \omega}+1)(0.8e^{4\pi i \omega} - 1.5e^{2\pi i \omega} +1)} \\
&= \frac{\sigma^2}{0.8e^{-4\pi i \omega} + 0.8e^{4\pi i \omega} - 2.7e^{-2\pi i \omega} - 2.7 e^{2\pi i \omega} + 3.89}
\end{aligned}
\]

Taking $\sigma^2 = 1$, we can plot this function in R for frequency range \([-\frac{1}{2}, \frac{1}{2}]\):

```{r, echo=FALSE}
omega = seq(from = -1/2, to = 1/2, length = 201)
alpha = -2 * pi * 1i * omega
lw = 1 / abs(0.8 * exp(alpha)^2 - 1.5 * exp(alpha) +1)^2
plot(omega, lw, type = "l", main="spectral density for AR2 model",
     xlab=expression(omega),ylab=expression(lambda(omega)))
# additional line to locate omega for peak value:
# omega[which.max(fx)]
# abline(v = omega[which.max(lw)], col = "blue")
```

**B.** For \(X_n=\epsilon_{n-2} + \epsilon_{n-1} +\epsilon_n\), \[
\begin{aligned}
\ar(B) &= 1\\
\ma(B) &= B^2 + B + 1
\end{aligned}
\]
therefore, its spectral density is \[
\begin{aligned}
\lambda(\omega) &= \sigma^2|(e^{-2\pi i \omega})^2 _+ e^{-2\pi i \omega} + 1|^2 \\
&= \sigma^2 (e^{-4\pi i \omega} + e^{4\pi i \omega} + 2e^{-2\pi i \omega} + 2e^{2\pi i \omega} + 3)
\end{aligned}
\]

Similarly, taking $\sigma^2 = 1$, we can plot its spectral density in R for frequency range \([-\frac{1}{2}, \frac{1}{2}]\):

```{r, echo=FALSE}
omega = seq(from = -1/2, to = 1/2, length = 201)
alpha = -2 * pi * 1i * omega
lw = abs(exp(alpha)^2 + exp(alpha) +1)^2
plot(omega, lw, type = "l", 
     main="spectral density for MA2 model",
     xlab=expression(omega),ylab=expression(lambda(omega)))
```

**C.** In comparison, the frequency terms are in the denominator for AR models but are in the nominator for MA models. Besides, from the plots we can see that the spectral density for AR models are generally low despite near the two peaks, where as the spectral density for MA models are generally high despite near the two troughs.

### Question 4.2

We want to estimate the spectral density of the subspot time series, where the raw data looks as follow:

```{r, fig.width=8, fig.height=3}
x <- read.table(file="https://ionides.github.io/531w20/hw04/sunspots.txt",header=TRUE)
plot(Number~Time,data=x,type="l", main="sunspot time series")
```

To start with, we first plot the unsmoothed periodogram:
```{r}
par(mfrow=c(2,1))
spectrum(x$Number, main="Unsmoothed periodogram, log-spectrum")
sp = spectrum(x$Number, main="Unsmoothed periodogram", log="no")
```

We can find the maximum frequency value in its spectrum and calculate its corresponding period:

```{r}
1/sp$freq[which.max(sp$spec)]/12
```

We know that the solar cycle is 11 years [3], and this estimation is pretty close. However, from the log-spectrum plot, we can see that the unsmoothed periodogram suffers considerable fluctuations. Besides, in the original spectrum there are some overlaps near zero so we zoom in the area to get a closer inspection: 

```{r, fig.width=8, fig.height=3}
plot(sp$freq[1:120], sp$spec[1:120], type="l")
```

From the zoomed-in plot, we can see that there are two closely related peaks, and we may try some smoothing method to reduce the noise. The simplest smoothing window is the Daniell spectral window:

```{r, fig.width=8, fig.height=9}
par(mfrow=c(3,1))
spectrum(x$Number, kernel("modified.daniell"), main="kernel=Daniel, log-spectrum")
sp2 = spectrum(x$Number, kernel("modified.daniell"), main="kernel=Daniel", log="no")
plot(sp2$freq[1:120], sp2$spec[1:120], type="l", main="kernel=Daniel, zoomed in")
```

And the period calculated from this estimation is 
```{r}
1/sp2$freq[which.max(sp2$spec)]/12
```

which is the same as calculated by the unsmoothed spectral.

`pgram` is the default estimator used by `spectrum`. We could also use an AR model for estimation:

```{r, fig.width=8, fig.height=9}
par(mfrow=c(3,1))
spectrum(x$Number, method="ar", main="AR, log-spectrum")
sp3 = spectrum(x$Number, method="ar", main="AR", log="no")
plot(sp3$freq[1:120], sp3$spec[1:120], type="l", main="AR, zoomed in")
```

The AR model provides a clean-shaped spectral density, with only one peak. The corresponding period is
```{r}
1/sp3$freq[which.max(sp3$spec)]/12
```

Howewver, this estimation is not as good as the previous estimation given by the periodogram estimator.

Frome question 4.1, we know that the spectral density resembles an AR2 model. We can check the ACF plot of the sunspot time series to check if the AR model is suitable:

```{r}
acf(x$Number,lag.max=1210)
```

The time series is recorded on a mothly basis and the solar cycle is approximately 11 years. Therefore, a cycle is $11\times 12 = 121$ months. As we can see from the acf plot, the correlation exists far more than 22 years, which means the AR model may not be adequate enough to represent the pattern of the time series. Therefore, AR estimator is not as good as the periodogram estimator.

In conclusion, the periodogram is a much more suitable choice for this question. It provides more accurate estimation of period of the time series.

### 4.3 Reference
1. Question 4.1, Formula of spectral densitiy of ARMA models, https://www.stat.ncsu.edu/people/bloomfield/courses/st730/slides/sns-04-2.pdf

2. Question 4.2, Hints of several estimator selection methods, *A spectrual analysis of the sunspot time series using the periodogram*, http://web.cecs.pdx.edu/~ssp/Reports/2005/Olvera.pdf

3. Question 4.2, solar cycle, https://en.wikipedia.org/wiki/Solar_cycle

4. Daniel spectral window, https://www.stat.berkeley.edu/~aditya/resources/LectureTWENTYSIX.pdf

5. Question 4.2, function reference, http://www.iam.fmph.uniba.sk/institute/stehlikova/ts16/lectures/8_spectrum.pdf





